

<script>

</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxqL3eG6quOKEbnY7d00DUPX0h5yoqS5Q&callback=initMap">
</script>
<style>
    #map {
        height: 400px;
        width: 100%;
    }
</style>


<div id="map"></div>
<script>


    function initMap() {

        var bounds = new google.maps.LatLngBounds();

        var connection = new WebSocket('ws://localhost:9090');

        var map = false;
        var marker = false;

         map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -30.0, lng: -60.0},
            zoom: 16
        });



        if (navigator.geolocation) {

            setInterval(function () {

                navigator.geolocation.getCurrentPosition(function (position) {
                    var position={lat:position.coords.latitude,lng:position.coords.longitude};

                    connection.send(JSON.stringify({"type":"share-location","location":position}));

                    if(bounds)
                    {
                        bounds.extend(position);
                        map.fitBounds(bounds);
                        bounds = false;
                    }

                    marker = new google.maps.Marker({
                        position: position,
                        map: map
                    });




                }, function (error) {

                    alert(error);
                });


            },2000);

        }





    }
</script>


